-- CONSULTAS PARA BASE DE DCOMUENTACI�N DE PROYECTOS PEOPLESOFT. 
-- RAUL BARRIOS 
-- 20210129
-- VERSION 2.0.0
-- PARA BUSCAR LAS TABLAS DE DEFINCI�N DE OBJETOS DE PEOPLE SOFT BASE DE DATOS SQLSERVER 
------------------------------------------------------------------------------------------------
select * from DBA_TABLES WHERE TABLE_NAME LIKE '%CODE%' AND TABLE_NAME LIKE '%DEFN%' ORDER BY 2 ;
select * from DBA_TABLES WHERE TABLE_NAME LIKE '%CODE%' ORDER BY 2 ;

 SELECT CASE 
 WHEN A.OBJECTTYPE = 0 THEN 'Record'  
 WHEN A.OBJECTTYPE = 1 THEN 'Index'
 WHEN A.OBJECTTYPE = 2 THEN 'Field' 
 WHEN A.OBJECTTYPE = 4 THEN 'XLAT' 
 WHEN A.OBJECTTYPE = 5 THEN 'Pagina' 
 WHEN A.OBJECTTYPE = 6 THEN 'Menu' 
 WHEN A.OBJECTTYPE = 7 THEN 'Componente'  
 WHEN A.OBJECTTYPE = 8  THEN 'People Code '
 WHEN A.OBJECTTYPE = 10 THEN 'Query'
 WHEN A.OBJECTTYPE = 19 THEN 'Role'
 WHEN A.OBJECTTYPE = 20 THEN 'Process Definition'
 WHEN A.OBJECTTYPE = 21 THEN 'Process Server Definition'
 WHEN A.OBJECTTYPE = 22 THEN 'Process Type Definition'
 WHEN A.OBJECTTYPE = 23 THEN 'Process Job Definition'
 WHEN A.OBJECTTYPE = 23 THEN 'JOB Definition'
 WHEN A.OBJECTTYPE = 25 THEN 'Message Catalog'
 WHEN A.OBJECTTYPE = 30 THEN 'SQL' 
 WHEN A.OBJECTTYPE = 33 THEN 'Application Engine ' 
 WHEN A.OBJECTTYPE = 32 THEN 'Conponent Interface ' 
 WHEN A.OBJECTTYPE = 37 THEN 'Message Web Service'
 WHEN A.OBJECTTYPE = 34 THEN 'Application Engine Section'
 WHEN A.OBJECTTYPE = 43 THEN 'Application Engine Step'
 WHEN A.OBJECTTYPE = 44 THEN 'PeopleCodePage ' 
 WHEN A.OBJECTTYPE = 46 THEN 'People code Component'
 WHEN A.OBJECTTYPE = 48 THEN 'PeoplecodeComponent ' 
 WHEN A.OBJECTTYPE = 53 THEN 'Lista de permisos'  
 WHEN A.OBJECTTYPE = 54 THEN 'Regsitro '  
 WHEN A.OBJECTTYPE = 55 THEN 'Estructura'
 WHEN A.OBJECTTYPE = 56 THEN 'url'
 WHEN A.OBJECTTYPE = 57 THEN 'Application Package'
 WHEN A.OBJECTTYPE = 58 THEN 'Application Package Class'
 WHEN A.OBJECTTYPE = 79 THEN 'Web service '
 WHEN A.OBJECTTYPE = 80 THEN 'Operation'
 WHEN A.OBJECTTYPE = 81 THEN 'Service Operation Handler'
 WHEN A.OBJECTTYPE = 82 THEN 'Service Operation Version'
 WHEN A.OBJECTTYPE = 83 THEN 'Service Operation Routing'
 WHEN A.OBJECTTYPE = 85 THEN 'BIP Template Definition'
 WHEN A.OBJECTTYPE = 86 THEN 'BIP Report defintion'
 WHEN A.OBJECTTYPE = 87 THEN 'BIP File definition'
 WHEN A.OBJECTTYPE = 89 THEN 'WSDL'
 WHEN A.OBJECTTYPE = 90 THEN 'Message Schema' 
 WHEN A.OBJECTTYPE = 92 THEN 'Documents' 
 WHEN A.OBJECTTYPE = 93 THEN 'XML Documnets' 
 WHEN A.OBJECTTYPE = 96 THEN 'Document Schemas' 
 WHEN A.OBJECTTYPE = 110 THEN 'json documents' 
 WHEN A.OBJECTTYPE = 120 THEN 'HTML Documents' 
 END TIPO,  
 concat(A.OBJECTVALUE1,' ', A.OBJECTVALUE2,' ', A.OBJECTVALUE3,' ', A.OBJECTVALUE4 ) Descrp
 FROM PSPROJECTITEM A   WHERE PROJECTNAME = 'AJ_CASO443824_RB' ORDER BY 1,2;
   
--   select *  FROM PSPROJECTITEM A WHERE PROJECTNAME = 'AJ_CASO443824_RB';
--   select count(1), A.OBJECTTYPE  FROM PSPROJECTITEM A WHERE PROJECTNAME = 'AJ_CASO443824_RB' group by A.OBJECTTYPE order by count(1);
 
-- record del proyecto.
 SELECT  DISTINCT B.RECNAME,  
 CASE WHEN RECTYPE = 0 THEN  'Data Table' 
 WHEN RECTYPE =   1 THEN  'Vista'
 WHEN RECTYPE =  2 THEN  'Derived Work'
 WHEN RECTYPE =  3 THEN  'Subrecord'
 WHEN RECTYPE =  4 THEN  'Huy!'
 WHEN RECTYPE = 5 THEN 'Vista Dinamica'
 WHEN RECTYPE =  6 THEN  'Query view'
 WHEN RECTYPE =  7 THEN  'Tabla Temporal' END RECTYPE,
 ISNULL(B.RECDESCR,C.RECDESCR) DESCR
 FROM PSPROJECTITEM A 
 LEFT JOIN PSRECDEFN B ON  A.OBJECTVALUE1 = B.RECNAME
 LEFT JOIN  PSRECDEFNLANG C ON A.OBJECTVALUE1 = C.RECNAME
 WHERE PROJECTNAME='AJ_CASO443824_RB' 
 
 
 -- Estructura de records del proyecto 
 --  APP ENG del proyecto.
 SELECT * FROM PSAEAPPLDEFN
SELECT DISTINCT A.OBJECTVALUE1,C.DESCR FROM PSPROJECTITEM A LEFT JOIN PSAEAPPLDEFN C ON A.OBJECTVALUE1 = C.AE_APPLID
WHERE PROJECTNAME='AJ_CASO443824_RB' AND A.OBJECTTYPE = 33;
 --  APP PACK DEL PROYECTO.
 SELECT DISTINCT A.OBJECTVALUE1,C.DESCR FROM PSPROJECTITEM A,PSPACKAGELANG C WHERE PROJECTNAME='AJ_CASO443824_RB' AND A.OBJECTVALUE1 = C.PACKAGEROOT(+) AND A.OBJECTTYPE = 57 AND PACKAGEROOT = PACKAGEID;
 --  DEFICI�N DE REPORTES DEL PROYECTO.
SELECT DISTINCT A.OBJECTVALUE1,C.DESCR FROM PSPROJECTITEM A,PSXPRPTDEFN C WHERE PROJECTNAME='AJ_CASO443824_RB' AND A.OBJECTVALUE1 = C.REPORT_DEFN_ID(+) AND A.OBJECTTYPE = 86;
-- DEFINICION DE PLANTILLAS 
SELECT DISTINCT A.OBJECTVALUE1,C.DESCR FROM PSPROJECTITEM A,PSXPTMPLDEFN C WHERE PROJECTNAME='AJ_CASO443824_RB' AND A.OBJECTVALUE1 = C.TMPLDEFN_ID(+) AND A.OBJECTTYPE = 85;
-- DEFINICION DE COMPONENTES 
SELECT DISTINCT A.OBJECTVALUE1 COMPONENTE,C.DESCR DESCRIPCION FROM PSPROJECTITEM A LEFT JOIN PSPNLDEFN C ON A.OBJECTVALUE1 = C.PNLNAME WHERE PROJECTNAME='AJ_CASO443824_RB'  AND A.OBJECTTYPE = 7 ORDER BY 1 ;

-- CAMPOS 
SELECT DISTINCT A.OBJECTVALUE1, 
CASE WHEN C.FIELDTYPE = 0 THEN 'C'
WHEN C.FIELDTYPE =   1 THEN 'T'
WHEN C.FIELDTYPE =  2 THEN 'N'
WHEN C.FIELDTYPE =  3 THEN 'N'
WHEN C.FIELDTYPE =  4 THEN 'D'
WHEN C.FIELDTYPE =  5 THEN 'T'
WHEN C.FIELDTYPE =  6 THEN 'DT'
WHEN C.FIELDTYPE =  8 THEN 'I' END TIPO, C.LENGTH , L.LONGNAME, L.SHORTNAME
FROM PSPROJECTITEM A, PSDBFIELD C, PSDBFLDLABL L 
WHERE PROJECTNAME  = 'AJ_CASO443824_RB' AND A.OBJECTVALUE1 = C.FIELDNAME AND A.OBJECTVALUE1 = L.FIELDNAME 
AND A.OBJECTTYPE   = 2 ORDER BY 1 ;

-- CAMPOS SENCILLOS 
SELECT DISTINCT A.OBJECTVALUE1 , L.LONGNAME FROM PSPROJECTITEM A, PSDBFLDLABL L WHERE PROJECTNAME  = 'AJ_CASO443824_RB' AND A.OBJECTVALUE1 = L.FIELDNAME(+) AND A.OBJECTTYPE   = 2 ORDER BY 1 ;
-- MENU  
SELECT DISTINCT A.OBJECTVALUE1, B.DESCR FROM PSPROJECTITEM A, PSMENUDEFNLANG B WHERE PROJECTNAME  = 'AJ_CASO443824_RB' AND A.OBJECTVALUE1 = B.MENUNAME(+) AND A.OBJECTTYPE = 6 ORDER BY 1;
-- MENSAJES WEB  
SELECT DISTINCT A.OBJECTVALUE1, B.DESCR FROM PSPROJECTITEM A, PSMSGDEFN B WHERE PROJECTNAME  = 'AJ_CASO443824_RB' AND A.OBJECTVALUE1 = B.MSGNAME AND A.OBJECTTYPE = 37 ORDER BY 1;
-- PAGINAS
SELECT DISTINCT A.OBJECTVALUE1, B.DESCR FROM PSPROJECTITEM A,  PSPNLDEFNLANG B WHERE PROJECTNAME  = 'AJ_CASO443824_RB' AND A.OBJECTVALUE1 = B.PNLNAME AND A.OBJECTTYPE = 5 ORDER BY 1;
-- RECORD
-- CAMPOS DE RECORDS DEL PROYECTO 
SELECT  DISTINCT A.OBJECTVALUE1, ISNULL(B.RECDESCR,C.RECDESCR) DESCR FROM PSPROJECTITEM A LEFT JOIN PSRECDEFN B ON A.OBJECTVALUE1 = B.RECNAME LEFT JOIN PSRECDEFNLANG C ON A.OBJECTVALUE1 = C.RECNAME
WHERE PROJECTNAME  = 'AJ_CASO443824_RB' 
 AND A.OBJECTTYPE = 0 ORDER BY 1;
-- QUERY 
SELECT  DISTINCT A.OBJECTVALUE1, ISNULL(B.DESCR,C.DESCR) DESCR FROM PSPROJECTITEM A LEFT JOIN PSQRYDEFN B  ON  A.OBJECTVALUE1 = B.QRYNAME  LEFT JOIN  PSQRYDEFNLANG C ON A.OBJECTVALUE1 = C.QRYNAME 
WHERE PROJECTNAME  = 'AJ_CASO443824_RB' 
AND A.OBJECTTYPE = 10 ORDER BY 1;
-- SQL
SELECT * FROM PSSQLTEXTDEFN
SELECT DISTINCT B.SQLID, C.SQLTEXT
 FROM PSPROJECTITEM A , PSSQLDEFN B , PSSQLTEXTDEFN C 
WHERE PROJECTNAME  = 'AJ_CASO443824_RB' 
AND A.OBJECTVALUE1 = B.SQLID AND  B.SQLID = C.SQLID
AND A.OBJECTTYPE = 30 ORDER BY 1;
-- URL
SELECT  DISTINCT A.OBJECTVALUE1, B.DESCR DESCR FROM PSPROJECTITEM A , PSURLDEFN B 
WHERE PROJECTNAME  = 'AJ_CASO443824_RB' AND A.OBJECTVALUE1 = B.URL_ID(+) 
AND A.OBJECTTYPE = 56 ORDER BY 1;
-- WEB SERVICES 
SELECT  DISTINCT A.OBJECTVALUE1, B.DESCR DESCR FROM PSPROJECTITEM A , PSSERVICE B 
WHERE PROJECTNAME  = 'AJ_CASO443824_RB' AND A.OBJECTVALUE1 = B.IB_SERVICENAME(+) 
AND A.OBJECTTYPE = 79 ORDER BY 1;}
-- XLAT
SELECT  DISTINCT A.OBJECTVALUE1, A.OBJECTVALUE2, B.EFF_STATUS, B.EFFDT, XLATLONGNAME, XLATSHORTNAME 
FROM PSPROJECTITEM A , PSXLATITEM B 
WHERE PROJECTNAME  = 'AJ_CASO443824_RB' 
AND A.OBJECTVALUE1 = B.FIELDNAME(+) 
AND A.OBJECTVALUE2 = B.FIELDVALUE(+) 
AND A.OBJECTTYPE = 4
ORDER BY 1;





-- CAMPOS DE RECORDS DEL PROYECTO 
SELECT  DISTINCT R.RECNAME,C.FIELDNAME, CASE WHEN C.FIELDTYPE = 0 THEN 'C' WHEN C.FIELDTYPE = 1 THEN 'T' WHEN C.FIELDTYPE = 2 THEN 'N' WHEN C.FIELDTYPE = 3 THEN 'N'
WHEN C.FIELDTYPE = 4 THEN 'D' WHEN C.FIELDTYPE = 5 THEN 'T' WHEN C.FIELDTYPE = 6 THEN 'DT' WHEN C.FIELDTYPE = 8 THEN 'I' END TIPO,  CASE WHEN K.INDEXID IS NULL THEN 'NO' ELSE 'SI' END _KEY ,  C.LENGTH , 
R.EDITTABLE , L.LONGNAME, L.SHORTNAME
FROM PSPROJECTITEM P , PSRECFIELD R LEFT JOIN PSKEYDEFN K ON R.RECNAME = K.RECNAME AND R.FIELDNAME = K.FIELDNAME , PSDBFIELD C , PSDBFLDLABL L ,  PSDBFLDLABLLANG LE
WHERE P.PROJECTNAME='AJ_CASO443824_RB' AND P.OBJECTTYPE = 0  
AND P.OBJECTVALUE1 = R.RECNAME AND R.FIELDNAME = C.FIELDNAME AND R.FIELDNAME = L.FIELDNAME AND R.FIELDNAME = L.LABEL_ID 
AND L.LABEL_ID = LE.LABEL_ID AND LE.LANGUAGE_CD = 'ESP' ORDER BY R.RECNAME, C.FIELDNAME;
 

 ---- PEOPLE CODE
 SELECT * FROM PSTYPECODEDEFN
 WHEN A.OBJECTTYPE = 8  THEN 'People Code '
